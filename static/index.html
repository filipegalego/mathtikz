<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MathTikZ ‚Äì Gerador de Imagens para Professores</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', sans-serif; background: #f0f4ff; color: #222; min-height: 100vh; }

  /* =================== BANNER =================== */
  /* Para personalizar o banner edita apenas esta sec√ß√£o */
  .banner {
    background: linear-gradient(135deg, #1a237e, #3949ab); /* Muda as cores aqui */
    color: white;
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .banner-logo {
    font-size: 2rem;
    line-height: 1;
    /* Substitui o emoji por uma imagem:
       <img src="logo.png" style="height:48px"> */
  }
  .banner-text h1 {
    font-size: clamp(1.1rem, 3vw, 1.5rem);
    font-weight: 700;
    letter-spacing: 0.5px;
  }
  .banner-text p {
    font-size: clamp(0.75rem, 2vw, 0.9rem);
    opacity: 0.85;
    margin-top: 0.15rem;
  }
  .banner-extra {
    margin-left: auto;
    text-align: right;
    font-size: 0.8rem;
    opacity: 0.8;
    /* Podes colocar aqui o nome da escola, log√≥tipo, etc. */
  }
  /* ============================================== */

  .container { max-width: 860px; margin: 1.5rem auto; padding: 0 1rem; }

  .card {
    background: white;
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 1.25rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  }
  .card h2 {
    font-size: clamp(0.95rem, 2.5vw, 1.05rem);
    font-weight: 600;
    color: #3949ab;
    margin-bottom: 0.5rem;
  }
  .hint {
    font-size: clamp(0.75rem, 2vw, 0.85rem);
    color: #666;
    font-style: italic;
    margin-bottom: 1rem;
    line-height: 1.4;
  }

  /* Exemplos */
  .examples-label { font-size: 0.85rem; color: #555; margin-bottom: 0.5rem; font-weight: 600; }
  .examples {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-bottom: 1rem;
  }
  .ex-btn {
    background: #e8eaf6;
    border: 1.5px solid #c5cae9;
    border-radius: 20px;
    padding: 0.3rem 0.75rem;
    font-size: clamp(0.7rem, 2vw, 0.8rem);
    cursor: pointer;
    transition: all 0.2s;
    line-height: 1.4;
  }
  .ex-btn:hover, .ex-btn:active { background: #c5cae9; }

  /* Textarea */
  textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1.5px solid #c5cae9;
    border-radius: 8px;
    font-size: clamp(0.85rem, 2.5vw, 0.95rem);
    resize: vertical;
    min-height: 80px;
    font-family: inherit;
    line-height: 1.5;
  }
  textarea:focus { outline: none; border-color: #3949ab; }

  /* Op√ß√µes */
  .options-row {
    display: flex;
    gap: 0.75rem;
    margin-top: 0.75rem;
    flex-wrap: wrap;
    align-items: center;
    font-size: clamp(0.8rem, 2vw, 0.85rem);
    color: #444;
  }
  select {
    padding: 0.45rem 0.75rem;
    border: 1.5px solid #c5cae9;
    border-radius: 8px;
    font-size: clamp(0.8rem, 2vw, 0.85rem);
    flex: 1;
    min-width: 160px;
  }

  /* Bot√£o gerar */
  .btn-gen {
    background: linear-gradient(135deg, #1a237e, #3949ab);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-size: clamp(0.9rem, 2.5vw, 1rem);
    font-weight: 600;
    cursor: pointer;
    margin-top: 1rem;
    width: 100%;
    transition: opacity 0.2s;
    -webkit-tap-highlight-color: transparent;
  }
  .btn-gen:hover { opacity: 0.9; }
  .btn-gen:disabled { opacity: 0.5; cursor: not-allowed; }

  .credits { font-size: 0.72rem; color: #aaa; text-align: right; margin-top: 0.35rem; }

  /* Status */
  .status { padding: 0.75rem 1rem; border-radius: 8px; font-size: 0.85rem; margin-top: 0.75rem; display: none; line-height: 1.4; }
  .status.info { background: #e3f2fd; color: #0d47a1; display: block; }
  .status.error { background: #ffebee; color: #c62828; display: block; }
  .status.success { background: #e8f5e9; color: #2e7d32; display: block; }

  /* Resultado */
  #result { display: none; }
  .result-preview { margin-bottom: 1rem; border-radius: 8px; overflow: hidden; }
  .result-preview iframe {
    width: 100%;
    height: clamp(300px, 60vw, 520px);
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    display: block;
  }

  /* Bot√µes de download */
  .btn-row { display: flex; gap: 0.6rem; flex-wrap: wrap; }
  .btn-dl {
    padding: 0.6rem 1.1rem;
    border-radius: 8px;
    border: none;
    font-size: clamp(0.8rem, 2.5vw, 0.9rem);
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    text-align: center;
    flex: 1;
    min-width: 120px;
    -webkit-tap-highlight-color: transparent;
  }
  .btn-pdf { background: #c62828; color: white; }
  .btn-png { background: #2e7d32; color: white; }
  .btn-code { background: #e8eaf6; color: #1a237e; border: 1.5px solid #c5cae9; }
  .btn-dl:hover { opacity: 0.85; }
  .btn-dl:disabled { opacity: 0.5; cursor: not-allowed; }

  /* C√≥digo LaTeX */
  .code-block {
    background: #1e1e2e;
    color: #cdd6f4;
    padding: 1rem;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: clamp(0.7rem, 2vw, 0.8rem);
    overflow-x: auto;
    white-space: pre;
    display: none;
    margin-top: 1rem;
    max-height: 280px;
    overflow-y: auto;
  }

  /* Spinner */
  .spinner {
    display: inline-block;
    width: 15px; height: 15px;
    border: 2px solid rgba(255,255,255,0.4);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    vertical-align: middle;
    margin-right: 6px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Mobile tweaks */
  @media (max-width: 480px) {
    .banner { padding: 0.8rem 1rem; gap: 0.6rem; }
    .banner-extra { display: none; }
    .card { padding: 1rem; border-radius: 8px; }
    .btn-row { gap: 0.5rem; }
    .btn-dl { min-width: 100px; padding: 0.55rem 0.75rem; }
  }
</style>
</head>
<body>

<!-- ========== BANNER ‚Äî edita aqui ========== -->
<div class="banner">
  <div class="banner-logo">üìê</div>
  <div class="banner-text">
    <h1>MathTikZ</h1>
    <p>Gerador de imagens matem√°ticas com TikZ/LaTeX</p>
  </div>
  <div class="banner-extra">
    <!-- Podes colocar aqui o nome da escola ou um log√≥tipo -->
    <!-- Exemplo: <img src="logo-escola.png" style="height:40px;opacity:0.9"> -->
    Para Professores de Matem√°tica<br>
    <span style="font-size:0.7rem;opacity:0.7;">by Filipe Galego</span>
  </div>
</div>
<!-- ========================================= -->

<div class="container">
  <div class="card">
    <h2>‚úèÔ∏è Descreve a imagem que queres criar</h2>
    <p class="hint">Para melhores resultados escreve um prompt detalhado e se necess√°rio faz ajustes e gera novamente a imagem.</p>

    <p class="examples-label">Exemplos r√°pidos:</p>
    <div class="examples">
      <button class="ex-btn" onclick="setPrompt(this.textContent)">Gr√°fico da fun√ß√£o seno de 0 a 2œÄ com eixos e grelha</button>
      <button class="ex-btn" onclick="setPrompt(this.textContent)">Circunfer√™ncia com centro O, raio, di√¢metro e corda marcados</button>
      <button class="ex-btn" onclick="setPrompt(this.textContent)">Diagrama de Venn com dois conjuntos A e B, interse√ß√£o sombreada</button>
      <button class="ex-btn" onclick="setPrompt(this.textContent)">Par√°bola y = x¬≤ - 4 com v√©rtice e intersec√ß√µes com eixos marcados</button>
      <button class="ex-btn" onclick="setPrompt(this.textContent)">Pol√≠gono regular hex√°gono inscrito numa circunfer√™ncia</button>
      <button class="ex-btn" onclick="setPrompt(this.textContent)">Gr√°fico de barras com 5 valores e eixos rotulados</button>
      <button class="ex-btn" onclick="setPrompt(this.textContent)">Dois tri√¢ngulos semelhantes com raz√£o de semelhan√ßa 2:3</button>
      <button class="ex-btn" onclick="setPrompt(this.textContent)">Tri√¢ngulo ret√¢ngulo com catetos a=3 e b=4 e hipotenusa c=5. Os labels dos comprimentos devem estar centrados em cada lado.</button>
    </div>

    <textarea id="prompt" placeholder="Ex: Tri√¢ngulo is√≥sceles com base 6 cm, lados iguais de 5 cm, altura tra√ßada, √¢ngulos marcados com arcos..."></textarea>

    <div class="options-row">
      <label>Modelo:</label>
      <select id="model">
        <option value="gemini-2.5-pro">Gemini 2.5 Pro (melhor qualidade)</option>
        <option value="gemini-2.0-flash">Gemini 2.0 Flash (mais r√°pido)</option>
      </select>
    </div>

    <button class="btn-gen" id="btnGen" onclick="generate()">‚ö° Gerar Imagem</button>
    <p class="credits">By Filipe Galego + Claude 4.6</p>
    <div class="status" id="status"></div>
  </div>

  <div class="card" id="result">
    <h2>üñºÔ∏è Resultado</h2>
    <div class="result-preview" id="previewArea"></div>
    <div class="btn-row">
      <a class="btn-dl btn-pdf" id="btnPdf" href="#" target="_blank">‚¨á PDF</a>
      <button class="btn-dl btn-png" id="btnPng" onclick="downloadPng()">‚¨á PNG</button>
      <button class="btn-dl btn-code" onclick="toggleCode()">{ } LaTeX</button>
    </div>
    <pre class="code-block" id="codeBlock"></pre>
  </div>
</div>

<script>
  function setPrompt(t) {
    document.getElementById('prompt').value = t;
    document.getElementById('prompt').focus();
    window.scrollTo({ top: document.getElementById('prompt').offsetTop - 20, behavior: 'smooth' });
  }

  async function generate() {
    const prompt = document.getElementById('prompt').value.trim();
    const model = document.getElementById('model').value;
    if (!prompt) return alert('Por favor escreve uma descri√ß√£o.');

    const btn = document.getElementById('btnGen');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span> A gerar c√≥digo TikZ...';
    setStatus('info', 'ü§ñ A contactar o modelo...');
    document.getElementById('result').style.display = 'none';

    try {
      const resp = await fetch('/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt, model })
      });
      const data = await resp.json();
      if (!resp.ok) throw new Error(data.error || 'Erro desconhecido');

      const code = data.code;
      document.getElementById('codeBlock').textContent = code;
      document.getElementById('btnPng').dataset.code = code;

      setStatus('info', 'üìê C√≥digo gerado! A compilar com LaTeX.Online...');
      btn.innerHTML = '<span class="spinner"></span> A compilar LaTeX...';

      const encoded = encodeURIComponent(code);
      const pdfUrl = 'https://latexonline.cc/compile?text=' + encoded + '&command=pdflatex';
      document.getElementById('previewArea').innerHTML =
        `<iframe src="${pdfUrl}" title="Imagem LaTeX"></iframe>`;
      document.getElementById('btnPdf').href = pdfUrl;
      document.getElementById('result').style.display = 'block';
      document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'start' });
      setStatus('success', '‚úÖ Imagem gerada com sucesso!');
    } catch (e) {
      setStatus('error', '‚ùå Erro: ' + e.message);
    } finally {
      btn.disabled = false;
      btn.innerHTML = '‚ö° Gerar Imagem';
    }
  }

  async function downloadPng() {
    const btn = document.getElementById('btnPng');
    const code = btn.dataset.code;
    if (!code) return alert('Gera uma imagem primeiro.');
    btn.textContent = '‚è≥ A gerar...';
    btn.disabled = true;
    try {
      const resp = await fetch('/png', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ code })
      });
      if (!resp.ok) {
        const err = await resp.json();
        throw new Error(err.error || 'Erro desconhecido');
      }
      const blob = await resp.blob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'imagem-matematica.png'; a.click();
      URL.revokeObjectURL(url);
    } catch (e) {
      alert('Erro ao gerar PNG: ' + e.message);
    } finally {
      btn.textContent = '‚¨á PNG';
      btn.disabled = false;
    }
  }

  function setStatus(type, msg) {
    const el = document.getElementById('status');
    el.className = 'status ' + type;
    el.textContent = msg;
  }

  function toggleCode() {
    const el = document.getElementById('codeBlock');
    el.style.display = el.style.display === 'block' ? 'none' : 'block';
  }
</script>
</body>
</html>